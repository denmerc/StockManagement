var Product;(function(n){var t=function(){function t(i,r){t.service==null&&(t.service=new n.Service(r)),t.scope==null&&(t.scope=i),t.categoryService==null&&(t.categoryService=new Category.Service(r)),this.SetupScope(i),t.GetAll()}return t.service=null,t.categoryService=null,t.scope=null,t.Create=function(n){return t.service.Create(n,function(n){t.scope.ProductsList.add(n),t.scope.Product=null,t.scope.OperationResultMessage=new OperationResultMessage("Success","Product saved",ResultMessageTypes.Success)},function(){t.scope.OperationResultMessage=new OperationResultMessage("Oops","Failed to save new Product",ResultMessageTypes.Error)})},t.GetAll=function(){return t.service.GetAll(null,function(n){t.scope.ProductsList=n},function(n){t.scope.OperationResultMessage=new OperationResultMessage("Oops","Failed to retrieve products",ResultMessageTypes.Error),console.log("Failed to get all products, reason: ",n)})},t.Get=function(n){return t.service.Get(n,function(){},function(){})},t.Update=function(n){return t.service.Update(n,function(){t.scope.OperationResultMessage=new OperationResultMessage("Success","Product updated",ResultMessageTypes.Success)},function(n){t.scope.OperationResultMessage=new OperationResultMessage("Oops!","Failed to update Product",ResultMessageTypes.Error),console.log(n)})},t.Delete=function(n){t.service.Delete(n,function(){console.log("deleted",n),t.scope.ProductsList.remove(function(t){return t.Id==n.Id}),t.scope.Product=null,t.scope.CategoriesList.forEach(function(n){n.Checked=!1}),t.scope.OperationResultMessage=new OperationResultMessage("Success","Product deleted",ResultMessageTypes.Success)},function(i){t.scope.OperationResultMessage=new OperationResultMessage("Oops!","Failed to delete product",ResultMessageTypes.Error),console.log("Failed to delete",n,i)})},t.prototype.SetupScope=function(n){n.Labels={},n.Labels.btnSave="Create",n.OperationResultMessage=null,t.categoryService.GetAll(null,function(t){n.CategoriesList=t},function(t){n.OperationResultMessage=new OperationResultMessage("Oops","Failed to load a list of categories",ResultMessageTypes.Error),console.log("Failed to load categories: ",t)}),n.$watch(function(n){return n.Product},function(n,t,i){i.Labels.btnSave=i.Product&&i.Product.Id?"Update":"Create"}),n.SelectProductForUpdate=function(t){console.log("setting Product for update",t),n.Product=t,n.CategoriesList.forEach(function(n){n.Checked=t.Categories==null?!1:t.Categories.some(function(t){return n.Id==t.Id})?!0:!1})},n.btnSave_Click=function(){var i=n.CategoriesList.findAll(function(n){return n.Checked==!0});n.Product.Categories=i,console.log("Saving a product: ",n.Product),n.Product.Id!=null?t.Update(n.Product):t.Create(n.Product)},n.btnDelete_Click=function(){t.Delete(n.Product)},n.btnClear_Click=function(){n.Product=null,n.CategoriesList.forEach(function(n){n.Checked=!1})}},t}();n.Controller=t})(Product||(Product={}))