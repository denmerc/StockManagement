var Product;(function(n){var t=function(){function t(i,r){t.service==null&&(t.service=new n.Service(r)),t.scope==null&&(t.scope=i),t.categoryService==null&&(t.categoryService=new Category.Service(r)),this.SetupScope(i),t.GetAll()}return t.service=null,t.categoryService=null,t.scope=null,t.Create=function(n){return t.service.Create(n,function(n){t.scope.ProductsList.add(n),t.scope.Product=null,t.scope.OperationResultMessage=new OperationResultMessage("Success","Product saved",ResultMessageTypes.Success)},function(){t.scope.OperationResultMessage=new OperationResultMessage("Oops","Failed to save new Product",ResultMessageTypes.Error)})},t.GetAll=function(){return t.service.GetAll(null,function(n){t.scope.ProductsList=n},function(n){t.scope.OperationResultMessage=new OperationResultMessage("Oops","Failed to retrieve products",ResultMessageTypes.Error),console.log("Failed to get all products, reason: ",n)})},t.Get=function(n){return t.service.Get(n,function(){},function(){})},t.Update=function(n){return t.service.Update(n,function(){t.scope.OperationResultMessage=new OperationResultMessage("Success","Product updated",ResultMessageTypes.Success)},function(n){t.scope.OperationResultMessage=new OperationResultMessage("Oops!","Failed to update Product",ResultMessageTypes.Error),console.log(n)})},t.Delete=function(n){t.service.Delete(n,function(){console.log("deleted",n),t.scope.ProductsList.remove(function(t){return t.Id==n.Id}),t.scope.Product=null,t.scope.CategoriesList.forEach(function(n){n.Checked=!1}),t.scope.OperationResultMessage=new OperationResultMessage("Success","Product deleted",ResultMessageTypes.Success)},function(i){t.scope.OperationResultMessage=new OperationResultMessage("Oops!","Failed to delete product",ResultMessageTypes.Error),console.log("Failed to delete",n,i)})},t.prototype.SetupScope=function(i){i.Labels={},i.Labels.btnSave="Create",i.OperationResultMessage=null,i.Product=new n.ProductModel,t.categoryService.GetAll(null,function(n){i.CategoriesList=n},function(n){i.OperationResultMessage=new OperationResultMessage("Oops","Failed to load a list of categories",ResultMessageTypes.Error),console.log("Failed to load categories: ",n)}),i.$watch(function(n){return n.Product},function(n,t,i){i.Labels.btnSave=i.Product&&i.Product.Id?"Update":"Create"}),i.SelectProductForUpdate=function(n){i.Product=n,i.CategoriesList.forEach(function(t){t.Checked=n.Categories==null?!1:n.Categories.some(function(n){return t.Id==n.Id})?!0:!1})},i.btnSave_Click=function(){var n=i.CategoriesList.findAll(function(n){return n.Checked});i.Product.Categories=n,console.log("Saving a product: ",i.Product),i.Product.Id!=null?t.Update(i.Product):t.Create(i.Product)},i.btnDelete_Click=function(){t.Delete(i.Product)},i.btnClear_Click=function(){i.Product=new n.ProductModel,i.CategoriesList.forEach(function(n){n.Checked=!1})},i.IsFormValid=function(){return i.Product&&i.Product.Name&&i.Product.Name.length>0&&i.CategoriesList.some(function(n){return n.Checked})}},t}();n.Controller=t})(Product||(Product={}))